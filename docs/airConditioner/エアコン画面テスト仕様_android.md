# エアコン画面テスト仕様書（Android版）

## 概要
トヨタ ハリアー ハイブリッド車のAndroid向けエアコン制御画面UIのテスト仕様書。
エアコン画面仕様書（Android版）に基づいて、機能・UI・UXの品質確保を目的としたテスト項目を定義する。

## テスト対象
- **対象画面**: エアコン制御画面
- **対象ファイル**: 
  - `AirConditionerScreen.kt`
  - `AirConditionerViewModel.kt`
  - `AirConditionerRepository.kt`
- **対象状態**: 初期表示、リクエスト中、完了の3状態

---

## 1. テストコードで実施可能な項目

### 1.1 ViewModelのロジックテスト（JUnit + Mockito）

#### 1.1.1 状態管理テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VM001 | 初期状態確認 | ViewModelインスタンス作成直後の状態確認 | currentState = AirConditionerState.Initial |
| VM002 | remainingTime初期値 | ViewModelインスタンス作成直後のremainingTime確認 | remainingTime = 10 |
| VM003 | countdownTime初期値 | ViewModelインスタンス作成直後のcountdownTime確認 | countdownTime = 9 |

#### 1.1.2 エアコン起動処理テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VM004 | startAirConditioner呼び出し | startAirConditioner()実行時の状態変更 | currentState = AirConditionerState.Requesting |
| VM005 | API成功時状態遷移 | API応答成功時の状態遷移 | currentState = AirConditionerState.Completed |
| VM006 | カウントダウン開始 | 完了状態遷移後のカウントダウンタイマー開始 | timerが動作している |

#### 1.1.3 エアコン停止処理テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VM007 | 完了状態からの停止 | 完了状態でstopAirConditioner()実行 | currentState = AirConditionerState.Initial |
| VM008 | カウントダウンリセット | 停止時のcountdownTimeリセット | countdownTime = 9 |
| VM009 | タイマー停止 | 停止時の全タイマー無効化 | timer = null |

#### 1.1.4 タイマー処理テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VM010 | カウントダウン減算 | 1分経過時のcountdownTime減算 | countdownTime -= 1 |
| VM011 | カウントダウン終了 | countdownTime = 0時の自動停止 | currentState = AirConditionerState.Initial |
| VM012 | ViewModelCleared時のタイマー停止 | onCleared()でのタイマー停止 | 全タイマーが停止 |

#### 1.1.5 エラーハンドリングテスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VM013 | API通信エラー | 通信エラー時の状態変更 | currentState = AirConditionerState.Initial |
| VM014 | エラーメッセージ設定 | エラー時のメッセージ設定 | errorMessage != null |
| VM015 | タイムアウトエラー | タイムアウト時の状態変更 | currentState = AirConditionerState.Initial |

### 1.2 UI要素の存在確認テスト（Compose Testing）

#### 1.2.1 共通要素テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| UI001 | ツールバー存在確認 | 全状態でツールバーの存在確認 | ツールバーが表示されている |
| UI002 | ナビゲーションアイコン存在確認 | 戻るボタンの存在確認 | 戻るボタンが表示されている |
| UI003 | タイトル表示確認 | ツールバー中央の「エアコン」タイトル表示 | 「エアコン」が表示されている |
| UI004 | ヘルプアイコン存在確認 | ヘルプボタンの存在確認 | ヘルプボタンが表示されている |

#### 1.2.2 初期表示状態UI確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| UI005 | 設定確認メッセージ表示 | 「下記の設定でエアコンを起動します。」メッセージ表示 | メッセージが表示されている |
| UI006 | 確認問いかけ表示 | 「よろしいですか？」メッセージ表示 | メッセージが表示されている |
| UI007 | 設定タイトル表示 | 「エアコンの設定」タイトル表示 | タイトルが表示されている |
| UI008 | 変更TextButton表示 | 「変更する」TextButton表示 | TextButtonが表示されている |
| UI009 | 起動時間ラベル表示 | 「起動時間」ラベル表示 | ラベルが表示されている |
| UI010 | 起動時間数値表示 | 起動時間の数値表示（10） | 数値が表示されている |
| UI011 | 起動時間単位表示 | 「分間」単位表示 | 単位が表示されている |
| UI012 | 実行Button表示 | 「この設定で起動する」Button表示 | Buttonが表示されている |

#### 1.2.3 リクエスト中状態UI確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| UI013 | リクエスト中テキスト表示 | 「リクエスト中」テキスト表示 | テキストが表示されている |
| UI014 | CircularProgressIndicator表示 | ローディングアニメーション表示 | CircularProgressIndicatorが表示されている |
| UI015 | 動作中設定テキスト表示 | 「この設定で動作中」テキスト表示 | テキストが表示されている |
| UI016 | 停止Button無効状態 | 停止Buttonの無効状態確認 | Button.enabled = false |

#### 1.2.4 完了状態UI確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| UI017 | 停止までテキスト表示 | 「エアコン停止まで」テキスト表示 | テキストが表示されている |
| UI018 | カウントダウン数値表示 | カウントダウン数値（9）表示 | 数値が表示されている |
| UI019 | カウントダウン単位表示 | 「分」単位表示 | 単位が表示されている |
| UI020 | 起動時間数値表示（完了時） | 起動時間の数値（10）表示 | 数値が表示されている |
| UI021 | 停止Button表示（有効） | 赤色の「停止する」Button表示 | Buttonが表示・有効 |

#### 1.2.5 通知設定エリアUI確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| UI022 | 通知設定タイトル表示 | 「通知設定」タイトル表示 | タイトルが表示されている |
| UI023 | 通知説明文表示 | 通知に関する説明文表示 | 説明文が表示されている |
| UI024 | 設定アイコン表示 | 歯車アイコン表示 | アイコンが表示されている |
| UI025 | 設定Buttonテキスト表示 | 「アプリの通知を設定する」テキスト表示 | テキストが表示されている |

### 1.3 状態遷移テスト（Compose Testing）

#### 1.3.1 画面遷移確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| ST001 | 初期→リクエスト中遷移 | 実行Buttonタップ後の状態遷移 | Requesting状態に遷移 |
| ST002 | リクエスト中→完了遷移 | API成功後の状態遷移 | Completed状態に遷移 |
| ST003 | 完了→初期遷移（停止） | 停止Buttonタップ後の状態遷移 | Initial状態に遷移 |

### 1.4 データバインディングテスト（Compose Testing）

#### 1.4.1 値の表示確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| DB001 | remainingTime表示 | ViewModelのremainingTimeがUI反映 | 10が表示される |
| DB002 | countdownTime表示 | ViewModelのcountdownTimeがUI反映 | 9が表示される |
| DB003 | 状態変更による表示切替 | currentState変更時のUI切替 | 状態に応じたUIが表示 |

### 1.5 Repository層テスト（JUnit + MockWebServer）

#### 1.5.1 API通信テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| RP001 | エアコン起動API成功 | 正常なAPI応答の処理 | 成功結果を返す |
| RP002 | エアコン停止API成功 | 正常なAPI応答の処理 | 成功結果を返す |
| RP003 | API通信エラー | ネットワークエラーの処理 | 適切なエラーを返す |
| RP004 | APIタイムアウト | タイムアウトエラーの処理 | タイムアウトエラーを返す |

---

## 2. 手作業で実施する項目

### 2.1 視覚的デザイン確認

#### 2.1.1 カラーパレット確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VD001 | 背景色確認 | メイン背景色の確認 | 黒色 (#000000) |
| VD002 | ツールバー背景色確認 | ツールバー背景色の確認 | ダークグレー (#2C2C2E) |
| VD003 | 白色テキスト確認 | メインテキストの色確認 | 白色 (#FFFFFF) |
| VD004 | 薄いグレーテキスト確認 | サブテキスト・ラベルの色確認 | 薄いグレー (#8E8E93) |
| VD005 | 赤色要素確認 | アクションButton・TextButtonの色確認 | 赤色 (#FF3B30) |
| VD006 | 通知エリア背景確認 | 通知設定エリアの背景色確認 | (#1C1C1E) |

#### 2.1.2 フォント仕様確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VD007 | ツールバータイトルフォント | タイトルのフォントサイズ・太さ | 18sp、Medium |
| VD008 | メインテキストフォント | メインテキストのフォントサイズ | 16sp、Normal |
| VD009 | カウントダウン数値フォント | カウントダウン数値のフォント | 72sp、ExtraBold |
| VD010 | 時間数値（大）フォント | 初期画面時間数値のフォント | 36sp、ExtraBold |
| VD011 | 時間数値（小）フォント | 完了画面時間数値のフォント | 24sp、Bold |
| VD012 | Buttonテキストフォント | Buttonテキストのフォント | 16sp、Bold |
| VD013 | ラベルフォント | ラベルのフォントサイズ | 14sp、Normal |
| VD014 | 説明文フォント | 説明文のフォントサイズ | 12sp、Normal |

#### 2.1.3 レイアウト・配置確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VD015 | ツールバー高さ確認 | ツールバーの高さ確認 | 56dp |
| VD016 | メッセージエリア高さ確認 | 設定確認メッセージエリアの高さ | 120dp |
| VD017 | 設定表示エリア高さ確認 | 設定表示エリアの高さ | 150dp |
| VD018 | 実行Buttonサイズ確認 | 実行Buttonのサイズ確認 | fillMaxWidth、高さ48dp |
| VD019 | 停止Buttonサイズ確認 | 停止Buttonのサイズ確認 | width = 0.7f、高さ48dp |
| VD020 | Button角丸確認 | Buttonの角丸半径確認 | 8dp |
| VD021 | 要素間余白確認 | 各要素間の適切な余白確認 | 仕様通りの余白 |

### 2.2 アニメーション確認

#### 2.2.1 状態遷移アニメーション
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| AN001 | フェードイン/アウト確認 | 状態変更時のフェードアニメーション | 500msのフェード効果 |
| AN002 | カウントダウン更新アニメーション | 数字変更時のアニメーション | スムーズな数値変化 |
| AN003 | CircularProgressIndicator | ローディングアニメーションの回転 | 連続回転アニメーション |

### 2.3 インタラクション確認

#### 2.3.1 タップ操作確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| IN001 | ナビゲーションアイコンタップ | 戻るボタンのタップ応答 | 画面遷移・触覚フィードバック |
| IN002 | ヘルプアイコンタップ | ヘルプボタンのタップ応答 | 触覚フィードバック |
| IN003 | 変更TextButtonタップ | 「変更する」TextButtonのタップ応答 | 触覚フィードバック |
| IN004 | 実行Buttonタップ | 「この設定で起動する」Buttonタップ | 状態遷移・触覚フィードバック |
| IN005 | 停止Buttonタップ | 「停止する」Buttonタップ | 状態遷移・触覚フィードバック |
| IN006 | 通知設定Buttonタップ | 通知設定Buttonのタップ応答 | 触覚フィードバック |

#### 2.3.2 フィードバック確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| IN007 | 触覚フィードバック確認 | タップ時の軽い振動確認 | HapticFeedbackType.LightImpact |
| IN008 | Ripple効果確認 | Button押下時のRipple効果 | 300msのRippleアニメーション |

### 2.4 タイミング・動作確認

#### 2.4.1 自動動作タイミング
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| TM001 | カウントダウン更新タイミング | カウントダウンの更新間隔 | 1分毎に更新 |
| TM002 | カウントダウン終了動作 | カウントダウン0時の動作 | 自動的に初期状態に戻る |
| TM003 | API応答時間 | API応答の適切な処理時間 | 2秒以内 |

### 2.5 画面サイズ・回転対応

#### 2.5.1 デバイス対応確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| RS001 | コンパクトサイズ対応 | 小画面での表示確認 | レイアウト崩れなし |
| RS002 | 標準サイズ対応 | 標準画面での表示確認 | レイアウト崩れなし |
| RS003 | 大画面サイズ対応 | タブレット画面での表示確認 | レイアウト崩れなし |

#### 2.5.2 画面回転対応
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| RS004 | 縦画面表示 | ポートレート表示の確認 | 正常表示 |
| RS005 | 横画面表示 | ランドスケープ表示の確認 | レイアウト適切調整 |
| RS006 | 回転時状態保持 | 画面回転時の状態保持確認 | 状態が保持される |

### 2.6 アクセシビリティ確認

#### 2.6.1 TalkBack対応
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| AC001 | Buttonラベル読み上げ | 各ButtonのcontentDescription読み上げ | 適切なラベルで読み上げ |
| AC002 | 状態変更アナウンス | 状態変更時のアナウンス | 状態変更が音声で通知 |
| AC003 | カウントダウン読み上げ | カウントダウンの音声読み上げ | 数値が適切に読み上げ |

#### 2.6.2 フォントスケール対応
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| AC004 | フォントサイズ拡大 | システムフォント拡大時の表示 | テキストが拡大表示 |
| AC005 | フォントサイズ縮小 | システムフォント縮小時の表示 | テキストが縮小表示 |
| AC006 | レイアウト調整 | フォントサイズ変更時のレイアウト | レイアウトが適切に調整 |

### 2.7 エラーハンドリング確認

#### 2.7.1 通信エラー対応
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| ER001 | 通信エラー表示 | 通信エラー時のSnackBar表示 | 「通信エラーが発生しました。しばらく時間をおいて再度お試しください。」 |
| ER002 | エラー後画面遷移 | 通信エラー後の画面状態 | 初期表示画面に戻る |
| ER003 | 再試行ボタン | SnackBarの再試行アクション | 再試行処理が実行される |

### 2.8 パフォーマンス確認

#### 2.8.1 メモリ使用量
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| PF001 | メモリリーク確認 | 画面遷移時のメモリリーク | メモリリークなし |
| PF002 | タイマーリソース確認 | タイマー使用時のリソース管理 | 適切なリソース解放 |
| PF003 | Compose再コンポーズ | 不要な再コンポーズの発生 | 最小限の再コンポーズ |

#### 2.8.2 アニメーション性能
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| PF004 | 状態遷移性能 | 状態遷移時のパフォーマンス | 遅延なし |
| PF005 | スクロール性能 | 画面スクロール時の性能 | 60FPS維持 |

### 2.9 ライフサイクル確認

#### 2.9.1 Activity/Fragment ライフサイクル
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| LC001 | onPause時の処理 | アプリがバックグラウンドになった時 | タイマー一時停止 |
| LC002 | onResume時の処理 | アプリがフォアグラウンドに戻った時 | タイマー再開 |
| LC003 | onDestroy時の処理 | アクティビティ終了時 | リソース適切解放 |

---

## 3. テスト実施注意事項

### 3.1 テストコード実施時の注意
- **JUnit5** + **Mockito** を使用してViewModelのユニットテストを実装
- **Compose Testing** ライブラリを使用してUIテストを実装
- 非同期処理（Coroutine）のテストでは **TestCoroutineDispatcher** を使用
- UI要素の確認では **testTag** を設定して実施

### 3.2 手作業テスト実施時の注意
- 実機とエミュレーターの両方でテスト実施
- Android API 21以上での動作確認
- ダークテーマ・ライトテーマ両方での表示確認
- TalkBack設定を有効にしてテスト実施

### 3.3 回帰テスト
- コード修正時は関連するテスト項目をすべて再実施
- 状態遷移に関わる修正時は全状態のテストを実施
- UI修正時は視覚的デザイン確認項目をすべて再実施

### 3.4 CI/CD パイプライン
- ユニットテスト: 全プルリクエストで自動実行
- UIテスト: メインブランチマージ時に自動実行
- 手動テスト: リリース前に必ず実施

---

**作成日**: 2024年12月19日  
**バージョン**: 1.0  
**最終更新**: 2024年12月19日  
**対象仕様書**: エアコン画面仕様書（Android版）v1.0
**ベース仕様**: エアコン画面テスト仕様書（iOS版）v1.1
