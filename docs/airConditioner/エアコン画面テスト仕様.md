# エアコン画面テスト仕様書

## 概要
トヨタ ハリアー ハイブリッド車のスマートフォン向けエアコン制御画面UIのテスト仕様書。
エアコン画面仕様書に基づいて、機能・UI・UXの品質確保を目的としたテスト項目を定義する。

## テスト対象
- **対象画面**: エアコン制御画面
- **対象ファイル**: 
  - `AirConditionerView.swift`
  - `AirConditionerViewModel.swift`
- **対象状態**: 初期表示、完了の2状態

---

## 1. テストコードで実施可能な項目

### 1.1 ViewModelのロジックテスト

#### 1.1.1 状態管理テスト
| テストID | テスト項目            | テスト内容                               | 期待結果                    |
| ----- | ---------------- | ----------------------------------- | ----------------------- |
| VM001 | 初期状態確認           | ViewModelインスタンス作成直後の状態確認            | currentState = .initial |
| VM002 | remainingTime初期値 | ViewModelインスタンス作成直後のremainingTime確認 | remainingTime = 10      |
| VM003 | countdownTime初期値 | ViewModelインスタンス作成直後のcountdownTime確認 | countdownTime = 9       |

#### 1.1.2 エアコン起動処理テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VM004 | startAirConditioner呼び出し | startAirConditioner()実行後の状態変更 | currentState = .completed |
| VM005 | カウントダウン開始 | 完了状態遷移後のカウントダウンタイマー開始 | timerが動作している |

#### 1.1.3 エアコン停止処理テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VM006 | 完了状態からの停止 | 完了状態でstopAirConditioner()実行 | currentState = .initial |
| VM007 | カウントダウンリセット | 停止時のcountdownTimeリセット | countdownTime = 9 |
| VM008 | タイマー停止 | 停止時の全タイマー無効化 | timer = nil |

#### 1.1.4 タイマー処理テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VM009 | カウントダウン減算 | 1分経過時のcountdownTime減算 | countdownTime -= 1 |
| VM010 | カウントダウン終了 | countdownTime = 0時の自動停止 | currentState = .initial |
| VM011 | View非表示時のタイマー停止 | onViewDisappear()でのタイマー停止 | 全タイマーが停止 |

### 1.2 UI要素の存在確認テスト

#### 1.2.1 共通要素テスト
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| UI001 | ヘッダー存在確認 | 全状態でヘッダーの存在確認 | ヘッダーが表示されている |
| UI002 | 戻るボタン存在確認 | 戻るボタンの存在確認 | 戻るボタンが表示されている |
| UI003 | タイトル表示確認 | ヘッダー中央の「エアコン」タイトル表示 | 「エアコン」が表示されている |
| UI004 | ヘルプボタン存在確認 | ヘルプボタンの存在確認 | ヘルプボタンが表示されている |

#### 1.2.2 初期表示状態UI確認
| テストID | テスト項目       | テスト内容                      | 期待結果          |
| ----- | ----------- | -------------------------- | ------------- |
| UI005 | 設定確認メッセージ表示 | 「下記の設定でエアコンを起動します。」メッセージ表示 | メッセージが表示されている |
| UI006 | 確認問いかけ表示    | 「よろしいですか？」メッセージ表示          | メッセージが表示されている |
| UI007 | 設定タイトル表示    | 「エアコンの設定」タイトル表示            | タイトルが表示されている  |
| UI008 | 変更リンク表示     | 「変更する」リンク表示                | リンクが表示されている   |
| UI009 | 起動時間ラベル表示   | 「起動時間」ラベル表示                | ラベルが表示されている   |
| UI010 | 起動時間数値表示    | 起動時間の数値表示（10）              | 数値が表示されている    |
| UI011 | 起動時間単位表示    | 「分間」単位表示                   | 単位が表示されている    |
| UI012 | 実行ボタン表示     | 「この設定で起動する」ボタン表示           | ボタンが表示されている   |

#### 1.2.3 完了状態UI確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| UI013 | 停止までテキスト表示 | 「エアコン停止まで」テキスト表示 | テキストが表示されている |
| UI014 | カウントダウン数値表示 | カウントダウン数値（9）表示 | 数値が表示されている |
| UI015 | カウントダウン単位表示 | 「分」単位表示 | 単位が表示されている |
| UI016 | 起動時間数値表示（完了時） | 起動時間の数値（10）表示 | 数値が表示されている |
| UI017 | 停止ボタン表示（赤） | 赤色の「停止する」ボタン表示 | ボタンが表示されている |

#### 1.2.4 通知設定エリアUI確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| UI018 | 通知設定タイトル表示 | 「通知設定」タイトル表示 | タイトルが表示されている |
| UI019 | 通知説明文表示 | 通知に関する説明文表示 | 説明文が表示されている |
| UI020 | 設定アイコン表示 | 歯車アイコン表示 | アイコンが表示されている |
| UI021 | 設定ボタンテキスト表示 | 「アプリの通知を設定する」テキスト表示 | テキストが表示されている |

### 1.3 状態遷移テスト

#### 1.3.1 画面遷移確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| ST001 | 初期→完了遷移 | 実行ボタンタップ後の状態遷移 | completed状態に遷移 |
| ST002 | 完了→初期遷移（停止） | 停止ボタンタップ後の状態遷移 | initial状態に遷移 |

### 1.4 データバインディングテスト

#### 1.4.1 値の表示確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| DB001 | remainingTime表示 | ViewModelのremainingTimeがUI反映 | 10が表示される |
| DB002 | countdownTime表示 | ViewModelのcountdownTimeがUI反映 | 9が表示される |
| DB003 | 状態変更による表示切替 | currentState変更時のUI切替 | 状態に応じたUIが表示 |

---

## 2. 手作業で実施する項目

### 2.1 視覚的デザイン確認

#### 2.1.1 カラーパレット確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VD001 | 背景色確認 | メイン背景色の確認 | 黒色 (#000000) |
| VD002 | ヘッダー背景色確認 | ヘッダー背景色の確認 | ダークグレー (#2C2C2E) |
| VD003 | 白色テキスト確認 | メインテキストの色確認 | 白色 (#FFFFFF) |
| VD004 | 薄いグレーテキスト確認 | サブテキスト・ラベルの色確認 | 薄いグレー (#8E8E93) |
| VD005 | 赤色要素確認 | アクションボタン・リンクの色確認 | 赤色 (#FF3B30) |
| VD006 | 通知エリア背景確認 | 通知設定エリアの背景色確認 | (#1C1C1E) |

#### 2.1.2 フォント仕様確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VD007 | ヘッダータイトルフォント | タイトルのフォントサイズ・太さ | 18px、Bold |
| VD008 | メインテキストフォント | メインテキストのフォントサイズ | 16px、Regular |
| VD009 | カウントダウン数値フォント | カウントダウン数値のフォント | 72px、Heavy |
| VD010 | 時間数値（大）フォント | 初期画面時間数値のフォント | 36px、Heavy |
| VD011 | 時間数値（小）フォント | 完了画面時間数値のフォント | 24px、Regular |
| VD012 | ボタンテキストフォント | ボタンテキストのフォント | 16px、Bold |
| VD013 | ラベルフォント | ラベルのフォントサイズ | 14px、Regular |
| VD014 | 説明文フォント | 説明文のフォントサイズ | 12px、Regular |

#### 2.1.3 レイアウト・配置確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| VD015 | ヘッダー高さ確認 | ヘッダーの高さ確認 | 約60px |
| VD016 | メッセージエリア高さ確認 | 設定確認メッセージエリアの高さ | 約100px |
| VD017 | 設定表示エリア高さ確認 | 設定表示エリアの高さ | 約120px |
| VD018 | 実行ボタンサイズ確認 | 実行ボタンのサイズ確認 | 幅90%、高さ50px |
| VD019 | 停止ボタンサイズ確認 | 停止ボタンのサイズ確認 | 幅70%、高さ50px |
| VD020 | ボタン角丸確認 | ボタンの角丸半径確認 | 8px |
| VD021 | 要素間余白確認 | 各要素間の適切な余白確認 | 仕様通りの余白 |

### 2.2 アニメーション確認

#### 2.2.1 状態遷移アニメーション
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| AN001 | フェードイン/アウト確認 | 状態変更時のフェードアニメーション | 0.5秒のフェード効果 |
| AN002 | カウントダウン更新アニメーション | 数字変更時のフェード効果 | 軽いフェード効果 |

### 2.3 インタラクション確認

#### 2.3.1 タップ操作確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| IN001 | 戻るボタンタップ | 戻るボタンのタップ応答 | 画面遷移・振動フィードバック |
| IN002 | ヘルプボタンタップ | ヘルプボタンのタップ応答 | 振動フィードバック |
| IN003 | 変更リンクタップ | 「変更する」リンクのタップ応答 | 振動フィードバック |
| IN004 | 実行ボタンタップ | 「この設定で起動する」ボタンタップ | 状態遷移・振動フィードバック |
| IN005 | 停止ボタンタップ | 「停止する」ボタンタップ | 状態遷移・振動フィードバック |
| IN006 | 通知設定ボタンタップ | 通知設定ボタンのタップ応答 | 振動フィードバック |

#### 2.3.2 フィードバック確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| IN007 | 振動フィードバック確認 | タップ時の軽い振動確認 | UIImpactFeedbackGenerator.light |
| IN008 | ボタン押下視覚フィードバック | ボタン押下時の背景色変更 | 明度変更（0.2秒） |

### 2.4 タイミング・動作確認

#### 2.4.1 自動動作タイミング
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| TM001 | カウントダウン更新タイミング | カウントダウンの更新間隔 | 1分毎に更新 |
| TM002 | カウントダウン終了動作 | カウントダウン0時の動作 | 自動的に初期状態に戻る |

### 2.5 画面サイズ・回転対応

#### 2.5.1 デバイス対応確認
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| RS001 | iPhone SE対応 | 小画面での表示確認 | レイアウト崩れなし |
| RS002 | iPhone Pro Max対応 | 大画面での表示確認 | レイアウト崩れなし |
| RS003 | iPad対応 | タブレット画面での表示確認 | レイアウト崩れなし |

#### 2.5.2 画面回転対応
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| RS004 | 縦画面表示 | ポートレート表示の確認 | 正常表示 |
| RS005 | 横画面表示 | ランドスケープ表示の確認 | レイアウト適切調整 |

### 2.6 アクセシビリティ確認

#### 2.6.1 VoiceOver対応
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| AC001 | ボタンラベル読み上げ | 各ボタンのラベル読み上げ | 適切なラベルで読み上げ |
| AC002 | 状態変更アナウンス | 状態変更時のアナウンス | 状態変更が音声で通知 |
| AC003 | カウントダウン読み上げ | カウントダウンの音声読み上げ | 数値が適切に読み上げ |

#### 2.6.2 Dynamic Type対応
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| AC004 | フォントサイズ拡大 | システムフォント拡大時の表示 | テキストが拡大表示 |
| AC005 | フォントサイズ縮小 | システムフォント縮小時の表示 | テキストが縮小表示 |
| AC006 | レイアウト調整 | フォントサイズ変更時のレイアウト | レイアウトが適切に調整 |

### 2.7 エラーハンドリング確認

#### 2.7.1 通信エラー対応
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| ER001 | 通信エラー表示 | 通信エラー時のアラート表示 | 「通信エラーが発生しました。しばらく時間をおいて再度お試しください。」 |
| ER002 | エラー後画面遷移 | 通信エラー後の画面状態 | 初期表示画面に戻る |

### 2.8 パフォーマンス確認

#### 2.8.1 メモリ使用量
| テストID | テスト項目      | テスト内容          | 期待結果      |
| ----- | ---------- | -------------- | --------- |
| PF001 | メモリリーク確認   | 画面遷移時のメモリリーク   | メモリリークなし  |
| PF002 | タイマーリソース確認 | タイマー使用時のリソース管理 | 適切なリソース解放 |

#### 2.8.2 アニメーション性能
| テストID | テスト項目 | テスト内容 | 期待結果 |
|----------|-----------|-----------|----------|
| PF003 | 状態遷移性能 | 状態遷移時のパフォーマンス | 遅延なし |

---

## 3. テスト実施注意事項

### 3.1 テストコード実施時の注意
- XCTestフレームワークを使用してViewModelのユニットテストを実装
- SwiftUI ViewのテストはViewInspectorライブラリの使用を推奨
- 非同期処理（Timer）のテストではXCTExpectationを使用
- UI要素の存在確認ではAccessibilityIdentifierを設定して実施

### 3.2 手作業テスト実施時の注意
- 実機とシミュレーターの両方でテスト実施
- iOS 15.0以上での動作確認
- ダークモード・ライトモード両方での表示確認
- アクセシビリティ設定を有効にしてテスト実施

### 3.3 回帰テスト
- コード修正時は関連するテスト項目をすべて再実施
- 状態遷移に関わる修正時は全状態のテストを実施
- UI修正時は視覚的デザイン確認項目をすべて再実施

---

**作成日**: 2024年12月19日  
**バージョン**: 1.1  
**最終更新**: 2024年12月19日  
**対象仕様書**: エアコン画面仕様書 v1.0