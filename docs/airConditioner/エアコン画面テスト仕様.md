# エアコン画面テスト仕様書

## 概要

エアコン画面のViewModel単体テスト仕様書です。State遷移条件を中心としたテスト項目を定義します。

## テスト対象

- **ViewModel**: AirConditionerViewModel
- **State Enum**: AirConditionerState
  - `INITIAL_DISPLAY` (初期表示)
  - `REQUESTING` (リクエスト中)
  - `COMPLETED` (完了)

## テスト環境設定

### 前提条件
- ViewModelは初期状態で`INITIAL_DISPLAY`を持つ
- 各State遷移は適切なタイミングで実行される
- エラーハンドリングは適切に実装されている

### テストデータ
- **初期設定値**: 起動時間 10分間
- **リクエスト処理時間**: 3-5秒（テストでは固定値を使用）
- **完了状態の残り時間**: 9分（初期設定10分から1分経過後）

---

## 1. 初期状態テスト

### 1.1 初期状態の確認
**テスト項目**: ViewModel初期化時の状態確認

**検証内容**:
- ViewModel初期化時に`INITIAL_DISPLAY`状態であること
- 初期設定値（起動時間10分間）が正しく設定されていること
- エアコン操作が未実行状態であること

**期待結果**:
- State: `INITIAL_DISPLAY`
- 起動時間: 10分間
- 操作状態: 未実行

---

## 2. 初期表示 → リクエスト中遷移テスト

### 2.1 正常な遷移
**テスト項目**: 「この設定で起動する」ボタンタップ時の状態遷移

**検証内容**:
- 初期表示状態から「この設定で起動する」アクション実行時
- 状態が`REQUESTING`に遷移すること
- 設定値が保持されること

**期待結果**:
- 遷移前: `INITIAL_DISPLAY`
- 遷移後: `REQUESTING`
- 起動時間: 10分間（変更なし）

### 2.2 設定値保持確認
**テスト項目**: リクエスト中状態での設定値保持

**検証内容**:
- リクエスト中状態でも初期設定値が保持されること
- 設定値が変更されていないこと

**期待結果**:
- 起動時間: 10分間
- 設定値: 初期値と同一

---

## 3. リクエスト中 → 完了遷移テスト

### 3.1 自動遷移
**テスト項目**: リクエスト中から完了状態への自動遷移

**検証内容**:
- リクエスト中状態から指定時間経過後
- 状態が`COMPLETED`に自動遷移すること
- 完了状態で適切な値が設定されること

**期待結果**:
- 遷移前: `REQUESTING`
- 遷移後: `COMPLETED`
- 残り時間: 9分（10分から1分経過）
- 起動時間: 10分間（設定値保持）

### 3.2 遷移タイミング
**テスト項目**: 自動遷移のタイミング確認

**検証内容**:
- リクエスト中状態から3-5秒後に自動遷移すること
- 遷移タイミングが適切であること

**期待結果**:
- 遷移時間: 3-5秒以内
- 遷移後: `COMPLETED`状態

---

## 4. 完了 → 初期表示遷移テスト

### 4.1 停止ボタンタップ
**テスト項目**: 「停止する」ボタンタップ時の状態遷移

**検証内容**:
- 完了状態から「停止する」アクション実行時
- 状態が`INITIAL_DISPLAY`に遷移すること
- 初期設定値に戻ること

**期待結果**:
- 遷移前: `COMPLETED`
- 遷移後: `INITIAL_DISPLAY`
- 起動時間: 10分間（初期値に戻る）
- 操作状態: 未実行

---

## 5. リクエスト中 → 初期表示遷移テスト

### 5.1 リクエスト中の停止
**テスト項目**: リクエスト中状態での「停止する」ボタンタップ

**検証内容**:
- リクエスト中状態から「停止する」アクション実行時
- 状態が`INITIAL_DISPLAY`に遷移すること
- リクエスト処理が中断されること

**期待結果**:
- 遷移前: `REQUESTING`
- 遷移後: `INITIAL_DISPLAY`
- 起動時間: 10分間（初期値に戻る）
- 操作状態: 未実行

---

## 6. エラーハンドリングテスト

### 6.1 ネットワークエラー
**テスト項目**: リクエスト処理中のネットワークエラー

**検証内容**:
- リクエスト中状態でネットワークエラー発生時
- 適切なエラー状態に遷移すること
- エラー情報が保持されること

**期待結果**:
- エラー発生時: エラー状態への遷移
- エラー情報: 適切に保持
- ユーザーへの通知: エラーメッセージ表示

### 6.2 タイムアウトエラー
**テスト項目**: リクエスト処理のタイムアウト

**検証内容**:
- リクエスト処理がタイムアウトした場合
- 適切なエラー状態に遷移すること
- タイムアウト情報が保持されること

**期待結果**:
- タイムアウト時: エラー状態への遷移
- エラー情報: タイムアウト情報保持
- ユーザーへの通知: タイムアウトメッセージ表示

---

## 7. 状態遷移の整合性テスト

### 7.1 不正な状態遷移
**テスト項目**: 不正な状態遷移の防止

**検証内容**:
- 完了状態から直接リクエスト中状態への遷移ができないこと
- 初期表示状態から直接完了状態への遷移ができないこと
- 状態遷移の整合性が保たれること

**期待結果**:
- 不正な遷移: 実行されない
- 現在の状態: 変更されない
- エラー情報: 適切に記録

### 7.2 同時実行の防止
**テスト項目**: 複数の状態遷移の同時実行防止

**検証内容**:
- 複数の状態遷移が同時に実行されないこと
- 状態遷移の排他制御が適切に動作すること

**期待結果**:
- 同時実行: 防止される
- 状態遷移: 順次実行される
- データ整合性: 保たれる

---

## 8. データ保持テスト

### 8.1 設定値の保持
**テスト項目**: 各状態での設定値保持

**検証内容**:
- 各状態遷移で設定値が適切に保持されること
- 設定値の変更が適切に反映されること

**期待結果**:
- 初期表示: 初期設定値保持
- リクエスト中: 設定値保持
- 完了: 設定値保持

### 8.2 タイマー値の管理
**テスト項目**: 残り時間の正確な管理

**検証内容**:
- 残り時間が正確に計算されること
- 時間の経過が適切に反映されること

**期待結果**:
- 初期値: 10分間
- 完了時: 9分間（1分経過後）
- 計算精度: 正確

---

## 9. パフォーマンステスト

### 9.1 状態遷移の応答性
**テスト項目**: 状態遷移の応答時間

**検証内容**:
- 状態遷移が適切な時間内に完了すること
- UIの応答性が保たれること

**期待結果**:
- 遷移時間: 100ms以内
- UI応答性: 良好

### 9.2 メモリ使用量
**テスト項目**: メモリ使用量の最適化

**検証内容**:
- 状態遷移でメモリリークが発生しないこと
- メモリ使用量が適切に管理されること

**期待結果**:
- メモリリーク: 発生しない
- メモリ使用量: 適切な範囲内

---

## 10. テスト実行順序

### 10.1 基本フロー
1. 初期状態テスト
2. 初期表示 → リクエスト中遷移テスト
3. リクエスト中 → 完了遷移テスト
4. 完了 → 初期表示遷移テスト

### 10.2 エラーフロー
1. リクエスト中 → 初期表示遷移テスト
2. エラーハンドリングテスト
3. 状態遷移の整合性テスト

### 10.3 パフォーマンステスト
1. データ保持テスト
2. パフォーマンステスト

---

## 11. テスト結果の評価基準

### 11.1 成功基準
- すべての状態遷移が期待通りに動作すること
- エラーハンドリングが適切に実装されていること
- パフォーマンスが許容範囲内であること

### 11.2 失敗基準
- 状態遷移が期待通りに動作しない場合
- エラーハンドリングが不適切な場合
- パフォーマンスが許容範囲を超える場合

---

## 12. テストデータ管理

### 12.1 テスト用設定値
- **起動時間**: 10分間
- **リクエスト処理時間**: 3秒（テスト用固定値）
- **完了状態の残り時間**: 9分

### 12.2 モックデータ
- **ネットワーク応答**: 成功/失敗のモック
- **タイマー**: テスト用の固定時間
- **エラー情報**: 各種エラーパターンのモック

---

## 13. 継続的テスト

### 13.1 回帰テスト
- 新機能追加時の既存機能テスト
- バグ修正時の関連機能テスト

### 13.2 パフォーマンステスト
- 定期的なパフォーマンス測定
- メモリ使用量の監視

---

## 14. テスト結果の記録

### 14.1 記録項目
- テスト実行日時
- テスト結果（成功/失敗）
- エラー情報（発生した場合）
- パフォーマンス測定値

### 14.2 レポート形式
- テスト結果サマリー
- 詳細なエラー情報
- パフォーマンス測定結果
- 改善提案

---

## 15. 注意事項

### 15.1 テスト実行時の注意
- テストは独立して実行可能であること
- テスト間での状態の依存関係を避けること
- テストデータのクリーンアップを適切に行うこと

### 15.2 実装時の注意
- テストしやすい設計を心がけること
- モック化しやすい構造にすること
- エラーハンドリングを適切に実装すること